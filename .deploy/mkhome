server {
        listen 80;
        listen [::]:80;

        root /home/marcin/gitrepos/html_projects;
        index index.html;

        server_name mkhome mkhome.byst.re www.mkhome.byst.re;

        error_page 404 /error404.html;
        # Block all hidden files and directories
        location ~ /\. {
            deny all;
            access_log off;
            log_not_found off;
        }

        add_header X-Frame-Options "SAMEORIGIN";
        add_header Content-Security-Policy "object-src 'none'; frame-ancestors 'none'; base-uri 'self';";
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
        add_header X-Content-Type-Options "nosniff";
        add_header Referrer-Policy "no-referrer-when-downgrade";
        add_header Permissions-Policy "geolocation=(self), midi=(), sync-xhr=(self), microphone=(), camera=(), magnetometer=()";

        # CSS and JS - shorter cache (1 hour) to allow updates to propagate quickly
        # For production, consider using versioning (styles.css?v=timestamp) and longer cache
        location ~* \.(css|js)$ {
            expires 1h;
            add_header Cache-Control "public, max-age=3600";
            add_header Vary "Accept-Encoding";
            try_files $uri =404;
        }

        # Images and fonts - longer cache (1 week)
        location ~* \.(jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 1w;
            add_header Cache-Control "public, max-age=604800";
            add_header Vary "Accept-Encoding";
            try_files $uri =404;
        }

        # HTML files - no cache to ensure fresh content
        location ~* \.(html)$ {
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
            add_header Pragma "no-cache";
            try_files $uri $uri/ =404;
        }

        location / {
                try_files $uri $uri/ =404;
        }
}



